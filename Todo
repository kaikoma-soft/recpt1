
0438名無しさん＠編集中 (ﾜｯﾁｮｲ bf02-h5l7)
2023/07/25(火) 23:29:10.27ID:+mELDrGA0
pt1_drvでもlinux 6.4以降ビルドできないので、stz2012版用に同様のパッチを作成
https://pastebin.com/A0eKX1x8



diff -uNr recpt1-master.orig/driver/pt1_pci.c recpt1-master/driver/pt1_pci.c
--- recpt1-master.orig/driver/pt1_pci.c	2023-05-03 00:20:10.000000000 +0900
+++ recpt1-master/driver/pt1_pci.c	2023-07-25 23:19:48.861092798 +0900
@@ -1033,7 +1033,11 @@
 static int __init pt1_pci_init(void)
 {
 	printk(KERN_INFO "%s", version);
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6,4,0)
+	pt1video_class = class_create(DRIVERNAME);
+#else
 	pt1video_class = class_create(THIS_MODULE, DRIVERNAME);
+#endif
 	if (IS_ERR(pt1video_class))
 		return PTR_ERR(pt1video_class);
 	return pci_register_driver(&pt1_driver);